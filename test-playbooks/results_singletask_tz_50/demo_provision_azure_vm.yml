---
- name: Deploy Azure resources and Create Azure VM
  hosts: localhost
  connection: local
  gather_facts: false

  # vars:
  #   vm_config:
  #     resource_group: rg-lightspeed
  #     location: eastus
  #     virtualnetwork:
  #       address_prefixes: 10.0.0.0/16
  #       name: vn_name
  #     subnet:
  #       address_prefix: 10.0.1.0/24
  #     network_interfaces:
  #       - nic-lightspeed
  #     image:
  #       offer: RHEL
  #       publisher: RedHat
  #       sku: 9-lvm
  #       version: latest
  #     ssh_public_keys:
  #       - path: /home/rhel/.ssh/authorized_keys
  #         key_data: "{{ pub_key_data | default(lookup('file', 'azure_demo_ssh_key.pub', errors='ignore')) }}"
  #     ssh_password_enabled: false
  #     vm_size: Standard_A1_v2
  #     vm_name: vm-lightspeed
  #     admin_username: rhel

  tasks:
    - name: Create a resource group
      ibm.ce_emea_rag.rag_resource_group:
        rag_workspace_id: "{{ rag_workspace_id }}"
        name: "{{ rag_resource_group_name }}"
        method: CREATE
      register: create_result

    - name: Create a virtual network
      ibm.ce_emea_rag.rag_virtual_network:
        rag_resource_group_id: "{{ rag_resource_group_id }}"
        name: Red_Hat_Partner Training_Portal
        method: CREATE
      register: create_result

    - name: Add subnet
      ibm.ce_emea_rag.rag_subnet:
        rag_resource_group_id: "{{ rag_resource_group_id }}"
        virtual_network_id: "{{ create_result.network_id }}"
        ip_address_start: 10.100.100.180
        ip_address_end: 10.100.101.24
        subnet_name: Red_Hat_Partner_Training_Portal
        method: CREATE
      register: create_result

    # Ansible Lightspeed does not have a suggestion for this input. Try changing your prompt, or contact your administrator with Suggestion Id bef19ab5-71ba-492e-b5ee-c5bcc2f48d2d for assistance
    #- name: Create a VM

    
    






