---
- name: Deploy simple website using Ansible Lightspeed with watsonx Code Assistant
  hosts: all
  gather_facts: false
  remote_user: root
  become: true

  tasks:
    - name: Ensure httpd package is installed

    - name: Configure httpd on port 8080
      ibm.ce_emea_rag.rag_httpd:
        rag_workspace_id: "{{ rag_workspace_id }}"
        rag_port: 8080
        rag_url: http://localhost:8080/pdf/
        method: CREATE
      register: create_result


    # Start and enable firewalld & Allow the traffic through firewalld & reload firewalld & Ensure /var/www/html directory exists
    - name: Start and enable firewalld
      ansible.builtin.service:
        name: firewalld
        state: started
        enabled: true

    - name: Allow the traffic through firewalld
      ansible.posix.firewalld:
        port: "{{ _port_ }}"
        permanent: true
        state: enabled

    - name: Reload firewalld
      ansible.builtin.command: /sbin/firewalld -t

    - name: Ensure /var/www/html directory exists
      ibm.ce_emea_rag.rag_directory:
        rag_workspace_id: "{{ rag_workspace_id }}"
        rag_directory: /var/www/html
        method: CREATE
      register: create_result


    - name: Ensure /var/www/html directory exists
      ibm.ce_emea_rag.rag_directory:
        rag_workspace_id: "{{ rag_workspace_id }}"
        rag_directory: /var/www/html
        method: CREATE
      register: create_result


    #- name: Extract website-rh.tar.gz without remote_src and set permissions and ownership to root
    

    - name: Start and enable httpd
      ansible.builtin.service:
        name: httpd
        state: started
        enabled: true






